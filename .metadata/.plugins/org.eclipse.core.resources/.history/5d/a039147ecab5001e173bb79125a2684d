<!doctype html>
<html lang="kr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" 
            rel="stylesheet" 
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" 
            crossorigin="anonymous">
    
  </head>
  <style>
    .d\:none{
      display: none;
    }
    .show{
      display: block;
    }

    .data-card{
      border: 1px solid gray;
    }
  </style>
  <body class="container">
    <h1>REST API 방식의 User DB 관리 프로그램</h1>
    <form>
      <div class="mb-3">
        <label for="inputId" class="form-label">Id</label>
        <input type="text" class="form-control" id="input-id" style="width:50%"aria-describedby="emailHelp">
        </div>
      <div class="mb-3">
        <label for="inputComment" class="form-label">Name</label>
        <input type="text" class="form-control" id="input-name" style="width:50%"aria-describedby="emailHelp">
      </div>
      <div class="mb-3">
        <label for="inputTitle" class="form-label">Email</label>
        <input type="text" class="form-control" id="input-email" style="width:50%"aria-describedby="emailHelp">
      </div>
        
    </form>
    <button type="submit" class="btn btn-primary" onclick="getJsonData()">Read</button>
    <button type="submit" class="btn btn-primary" onclick="postJsonData()">Create</button>
    <button type="submit" class="btn btn-primary" onclick="putJsonData()">Update</button>
    <button type="submit" class="btn btn-primary" onclick="deleteJsonData()">Delete</button>

    <br />
    <div id="json">
      
    </div>

    <script>
      let resultSection = document.getElementById('json');

      async function getJsonData() {
		  const uid = document.getElementById("input-id").value;
		  const uname = document.getElementById("input-name").value;
		  const uemail = document.getElementById("input-email").value;
		  
		  if (uid) {
			  const response = await fetch(`http://localhost:8080/list/id/${uid}`);
				
	          const jsonData = await response.json();
	          console.log(jsonData);
	          
	          resultSection.innerHTML = '';
           	  let number = jsonData.id;
              let template = `
                <section class="data-card">
                  <h1 class="card-number">number : ${jsonData.id}</h1>
                  <div class="user-id d:none">id : ${jsonData.id}</div>
                  <p class="user-email d:none">
                      email : ${jsonData.email}
                  </p>
                  <p class="user-name d:none">
                      name : ${jsonData.name}
                  </p>
                </section>
              `;

              resultSection.insertAdjacentHTML("beforeend", template);
              
              resultSection.addEventListener("click", async function(e) {
	  	          let dataCard = e.target.closest('.data-card');
	  	            
	  	          let cardNumber = dataCard.querySelector('.card-number');
	  	          let userId = dataCard.querySelector('.user-id');
	  	          let userEmail = dataCard.querySelector('.user-email');
	  	          let userName = dataCard.querySelector('.user-name');
	  	            
	  	          let arrayList = [userId, userEmail, userName];
	  	
	  	          if (dataCard.classList.contains('open')) {
	  	            dataCard.classList.remove('open');
	  	            for (let i = 0; i < arrayList.length; i++) {
	  	                arrayList[i].classList.add('d:none');
	  	                arrayList[i].classList.remove('show');
	  	            }
	  	          }
	  	          else {
	  	            dataCard.classList.add('open');
	  	            for (let i = 0; i < arrayList.length; i++) {
	  	                arrayList[i].classList.remove('d:none');
	  	                arrayList[i].classList.add('show');
	  	            }
	  	          }
	  	        })
		      }
	      else if (uname) {
	    	  const response = await fetch(`http://localhost:8080/list/name/${uname}`);
				
	          const jsonData = await response.json();
	          console.log(jsonData);
	          
	          resultSection.innerHTML = '';
           	  let number = jsonData.id;
              let template = `
                <section class="data-card">
                  <h1 class="card-number">number : ${jsonData.id}</h1>
                  <div class="user-id d:none">id : ${jsonData.id}</div>
                  <p class="user-email d:none">
                      email : ${jsonData.email}
                  </p>
                  <p class="user-name d:none">
                      name : ${jsonData.name}
                  </p>
                </section>
              `;

              resultSection.insertAdjacentHTML("beforeend", template);
	          
   		  }
	      else if (uemail) {
	    	  const response = await fetch(`http://localhost:8080/list/email/${uemail}`);
				
	          const jsonData = await response.json();
	          console.log(jsonData);
	          
	          resultSection.innerHTML = '';
           	  let number = jsonData.id;
              let template = `
                <section class="data-card">
                  <h1 class="card-number">number : ${jsonData.id}</h1>
                  <div class="user-id d:none">id : ${jsonData.id}</div>
                  <p class="user-email d:none">
                      email : ${jsonData.email}
                  </p>
                  <p class="user-name d:none">
                      name : ${jsonData.name}
                  </p>
                </section>
              `;

              resultSection.insertAdjacentHTML("beforeend", template);
	          
	      }
	      else {
	    	  const response = await fetch(`http://localhost:8080/list/all`);
	    		
	          const jsonData = await response.json();
	          console.log(jsonData);
	          
	          resultSection.innerHTML = '';
	          for (let i = 0; i < jsonData.length; i++) {
	            let number = jsonData[i].id;
	            let template = `
	              <section class="data-card">
	                <h1 class="card-number">number : ${jsonData[i].id}</h1>
	                <div class="user-id d:none">id : ${jsonData[i].id}</div>
	                <p class="user-email d:none">
	                    email : ${jsonData[i].email}
	                </p>
	                <p class="user-name d:none">
	                    name : ${jsonData[i].name}
	                </p>
	              </section>
	            `;
	
	            resultSection.insertAdjacentHTML("beforeend", template);
	          }
	
	          resultSection.addEventListener("click", async function(e) {
	            let dataCard = e.target.closest('.data-card');
	            
	            let cardNumber = dataCard.querySelector('.card-number');
	            let userId = dataCard.querySelector('.user-id');
	            let userEmail = dataCard.querySelector('.user-email');
	            let userName = dataCard.querySelector('.user-name');
	            
	            let arrayList = [userId, userEmail, userName];
	
	            if (dataCard.classList.contains('open')) {
	              dataCard.classList.remove('open');
	              for (let i = 0; i < arrayList.length; i++) {
	                  arrayList[i].classList.add('d:none');
	                  arrayList[i].classList.remove('show');
	              }
	            }
	            else {
	              dataCard.classList.add('open');
	              for (let i = 0; i < arrayList.length; i++) {
	                  arrayList[i].classList.remove('d:none');
	                  arrayList[i].classList.add('show');
	              }
	            }
	        })
	      }
      }

      async function postJsonData() {
          const pemail = document.getElementById("input-email").value;
          const pname = document.getElementById("input-name").value;
          
          const response = await fetch("http://localhost:8080/userdb/create", {
            method: "POST",
            headers: {
              "Content-Type" : "application/json"
            },
            body: JSON.stringify({
              "email": pemail,
              "name": pname
            })
          });
          
          const jsonData = await response.json();
          console.log(jsonData);

          resultSection.innerHTML = '';
          let template = `
              <div>
                message : 'Create Completed'
              </div>
              `;

          resultSection.insertAdjacentHTML("beforeend", template);
      }

      async function putJsonData() {
          const pid = document.getElementById("input-id").value;
          const pemail = document.getElementById("input-email").value;
          const pname = document.getElementById("input-name").value;
          
          const response = await fetch(`http://localhost:8080/update/${pid}`, {
            method: "PUT",
            headers: {
              "Content-Type" : "application/json"
            },
            body: JSON.stringify({
              "email": pemail,
              "name": pname,
            })
          });
          
          const jsonData = await response.json();
          console.log(jsonData);

          resultSection.innerHTML = '';
          let template = `
              <div>
                message : 'Update Completed'
              </div>
              `;

          resultSection.insertAdjacentHTML("beforeend", template);
      }

      async function deleteJsonData() {

          const pid = document.getElementById("input-id").value;
          
          const response = await fetch(`http://localhost:8080/delete/${pid}`, {
            method: "DELETE",
            headers: {
                "Content-Type": "application/json"
            },
          });
          
          const jsonData = await response.json();
          console.log(jsonData);

          resultSection.innerHTML = '';
          let template = `
              <div>
                message : 'Delete Completed'
              </div>
              `;

          resultSection.insertAdjacentHTML("beforeend", template);
      }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" 
            integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous">
    </script>
  </body>
</html> 